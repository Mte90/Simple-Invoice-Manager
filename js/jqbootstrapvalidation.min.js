/* jqBootstrapValidation
 * A plugin for automating validation on Twitter Bootstrap formatted forms.
 *
 * v1.3.3
 *
 * http://ReactiveRaven.github.com/jqBootstrapValidation/
 */

/* This program is free software. It comes without any warranty, to
 * the extent permitted by applicable law. You can redistribute it
 * and/or modify it under the terms of the Do What The Fuck You Want
 * To Public License, Version 2, as published by Sam Hocevar. See
 * http://sam.zoy.org/wtfpl/COPYING for more details. */
(function(a){function g(a){return new RegExp("^"+a+"$")}function h(a,b){var c=Array.prototype.slice.call(arguments).splice(2);var d=a.split(".");var e=d.pop();for(var f=0;f<d.length;f++){b=b[d[f]]}return b[e].apply(this,c)}var b=[];var c={options:{sniffHtml:true,preventSubmit:true,submitError:false,submitSuccess:false,event:null,autoAdd:{helpBlocks:true}},methods:{init:function(g){var h=a.extend(true,{},c);h.options=a.extend(true,h.options,g);var i=a("#"+a(this).parent().data("id-form"));var j=0;var k=i.find("input,textarea,select").not("[type=submit],[type=image]");k.trigger("submit.validation").trigger("validationLostFocus.validation");k.each(function(b,c){var d=a(c),e=d.parents(".control-group").first();if(e.hasClass("warning")){e.removeClass("warning").addClass("error");j++}});k.trigger("validationLostFocus.validation");if(j){if(h.options.preventSubmit){h.options.event.stopPropagation();h.options.event.stopImmediatePropagation();h.options.event.preventDefault()}i.addClass("error");if(a.isFunction(h.options.submitError)){h.options.submitError(i,e,k.jqBootstrapValidation("collectErrors",true))}}else{i.removeClass("error");if(a.isFunction(h.options.submitSuccess)){h.options.submitSuccess(i,e)}}return this.each(function(){var c=a(this),e=c.parents(".control-group").first(),g=e.find(".help-block").first(),i=c.parents("form").first(),j=[];if(!g.length&&h.options.autoAdd&&h.options.autoAdd.helpBlocks){g=a('<div class="help-block" />');e.find(".controls").append(g);b.push(g[0])}if(h.options.sniffHtml){var k="";if(c.attr("pattern")!==undefined){k="Not in the expected format";if(c.data("validationPatternMessage")){k=c.data("validationPatternMessage")}c.data("validationPatternMessage",k);c.data("validationPatternRegex",c.attr("pattern"))}if(c.attr("max")!==undefined||c.attr("aria-valuemax")!==undefined){var l=c.attr("max")!==undefined?c.attr("max"):c.attr("aria-valuemax");k="Too high: Maximum of '"+l+"'";if(c.data("validationMaxMessage")){k=c.data("validationMaxMessage")}c.data("validationMaxMessage",k);c.data("validationMaxMax",l)}if(c.attr("min")!==undefined||c.attr("aria-valuemin")!==undefined){var m=c.attr("min")!==undefined?c.attr("min"):c.attr("aria-valuemin");k="Too low: Minimum of '"+m+"'";if(c.data("validationMinMessage")){k=c.data("validationMinMessage")}c.data("validationMinMessage",k);c.data("validationMinMin",m)}if(c.attr("maxlength")!==undefined){k="Too long: Maximum of '"+c.attr("maxlength")+"' characters";if(c.data("validationMaxlengthMessage")){k=c.data("validationMaxlengthMessage")}c.data("validationMaxlengthMessage",k);c.data("validationMaxlengthMaxlength",c.attr("maxlength"))}if(c.attr("minlength")!==undefined){k="Too short: Minimum of '"+c.attr("minlength")+"' characters";if(c.data("validationMinlengthMessage")){k=c.data("validationMinlengthMessage")}c.data("validationMinlengthMessage",k);c.data("validationMinlengthMinlength",c.attr("minlength"))}if(c.attr("required")!==undefined||c.attr("aria-required")!==undefined){k=h.builtInValidators.required.message;if(c.data("validationRequiredMessage")){k=c.data("validationRequiredMessage")}c.data("validationRequiredMessage",k)}if(c.attr("type")!==undefined&&c.attr("type").toLowerCase()=="number"){k=h.builtInValidators.number.message;if(c.data("validationNumberMessage")){k=c.data("validationNumberMessage")}c.data("validationNumberMessage",k)}if(c.attr("type")!==undefined&&c.attr("type").toLowerCase()=="email"){k="Not a valid email address";if(c.data("validationValidemailMessage")){k=c.data("validationValidemailMessage")}else if(c.data("validationEmailMessage")){k=c.data("validationEmailMessage")}c.data("validationValidemailMessage",k)}if(c.attr("minchecked")!==undefined){k="Not enough options checked; Minimum of '"+c.attr("minchecked")+"' required";if(c.data("validationMincheckedMessage")){k=c.data("validationMincheckedMessage")}c.data("validationMincheckedMessage",k);c.data("validationMincheckedMinchecked",c.attr("minchecked"))}if(c.attr("maxchecked")!==undefined){k="Too many options checked; Maximum of '"+c.attr("maxchecked")+"' required";if(c.data("validationMaxcheckedMessage")){k=c.data("validationMaxcheckedMessage")}c.data("validationMaxcheckedMessage",k);c.data("validationMaxcheckedMaxchecked",c.attr("maxchecked"))}}if(c.data("validation")!=undefined){j=c.data("validation").split(",")}a.each(c.data(),function(a,b){var c=a.replace(/([A-Z])/g,",$1").split(",");if(c[0]=="validation"&&c[1]){j.push(c[1])}});var n=j;var o=[];do{a.each(j,function(a,b){j[a]=d(b)});j=a.unique(j);o=[];a.each(n,function(b,e){if(c.data("validation"+e+"Shortcut")!=undefined){a.each(c.data("validation"+e+"Shortcut").split(","),function(a,b){o.push(b)})}else if(h.builtInValidators[e.toLowerCase()]){var f=h.builtInValidators[e.toLowerCase()];if(f.type.toLowerCase()=="shortcut"){a.each(f.shortcut.split(","),function(a,b){b=d(b);o.push(b);j.push(b)})}}});n=o}while(n.length>0);var p={};a.each(j,function(b,e){var f=c.data("validation"+e+"Message");var g=f!=undefined;var i=false;f=f?f:"'"+e+"' validation failed <!-- Add attribute 'data-validation-"+e.toLowerCase()+"-message' to input to change this message -->";a.each(h.validatorTypes,function(b,g){if(p[b]==undefined){p[b]=[]}if(!i&&c.data("validation"+e+d(g.name))!==undefined){p[b].push(a.extend(true,{name:d(g.name),message:f},g.init(c,e)));i=true}});if(!i&&h.builtInValidators[e.toLowerCase()]){var j=a.extend(true,{},h.builtInValidators[e.toLowerCase()]);if(g){j.message=f}var k=j.type.toLowerCase();if(k=="shortcut"){i=true}else{a.each(h.validatorTypes,function(b,f){if(p[b]==undefined){p[b]=[]}if(!i&&k==b.toLowerCase()){c.data("validation"+e+d(f.name),j[f.name.toLowerCase()]);p[k].push(a.extend(j,f.init(c,e)));i=true}})}}if(!i){a.error("Cannot find validation info for '"+e+"'")}});g.data("original-contents",g.data("original-contents")?g.data("original-contents"):g.html());g.data("original-role",g.data("original-role")?g.data("original-role"):g.attr("role"));e.data("original-classes",e.data("original-clases")?e.data("original-classes"):e.attr("class"));c.data("original-aria-invalid",c.data("original-aria-invalid")?c.data("original-aria-invalid"):c.attr("aria-invalid"));c.bind("validation.validation",function(b,d){b=b;var e=f(c);var g=[];a.each(p,function(b,f){if(e||e.length||d&&d.includeEmpty||!!h.validatorTypes[b].blockSubmit&&d&&!!d.submitting){a.each(f,function(a,d){if(h.validatorTypes[b].validate(c,e,d)){g.push(d.message)}})}});return g});c.bind("getValidators.validation",function(a){a=a;return p});c.bind("submit.validation",function(){return c.triggerHandler("change.validation",{submitting:true})});c.bind(["keyup","focus","blur","click","keydown","keypress","change"].join(".validation ")+".validation",function(b,d){var h=f(c);var j=[];e.find("input,textarea,select").each(function(b,e){var f=j.length;a.each(a(e).triggerHandler("validation.validation",d),function(a,b){j.push(b)});if(j.length>f){a(e).attr("aria-invalid","true")}else{var g=c.data("original-aria-invalid");a(e).attr("aria-invalid",g!==undefined?g:false)}});i.find("input,select,textarea").not(c).not('[name="'+c.attr("name")+'"]').trigger("validationLostFocus.validation");j=a.unique(j);if(j.length){e.removeClass("success error").addClass("warning");g.html('<ul role="alert"><li>'+j.join("</li><li>")+"</li></ul>")}else{e.removeClass("warning error success");if(h.length>0){e.addClass("success")}g.html(g.data("original-contents"))}if(b.type=="blur"){e.removeClass("success")}});c.bind("validationLostFocus.validation",function(){e.removeClass("success")})})},destroy:function(){return this.each(function(){var c=a(this),d=c.parents(".control-group").first(),e=d.find(".help-block").first();c.unbind(".validation");e.html(e.data("original-contents"));d.attr("class",d.data("original-classes"));c.attr("aria-invalid",c.data("original-aria-invalid"));e.attr("role",c.data("original-role"));if(b.indexOf(e[0])>-1){e.remove()}})},collectErrors:function(b){var c={};this.each(function(b,d){var e=a(d);var f=e.attr("name");var g=e.triggerHandler("validation.validation",{includeEmpty:true});c[f]=a.extend(true,g,c[f])});a.each(c,function(a,b){if(b.length==0){delete c[a]}});return c},hasErrors:function(){var b=[];this.each(function(c,d){b=b.concat(a(d).triggerHandler("getValidators.validation")?a(d).triggerHandler("validation.validation",{submitting:true}):[])});return b.length>0},override:function(b){c=a.extend(true,c,b)}},validatorTypes:{callback:{name:"callback",init:function(a,b){return{validatorName:b,callback:a.data("validation"+b+"Callback"),lastValue:a.val(),lastValid:true,lastFinished:true}},validate:function(a,b,c){if(c.lastValue==b&&c.lastFinished){return!c.lastValid}if(c.lastFinished==true){c.lastValue=b;c.lastValid=true;c.lastFinished=false;var d=c;var e=a;h(c.callback,window,a,b,function(a){if(d.lastValue==a.value){d.lastValid=a.valid;if(a.message){d.message=a.message}d.lastFinished=true;e.data("validation"+d.validatorName+"Message",d.message);setTimeout(function(){e.trigger("change.validation")},1)}})}return false}},ajax:{name:"ajax",init:function(a,b){return{validatorName:b,url:a.data("validation"+b+"Ajax"),lastValue:a.val(),lastValid:true,lastFinished:true}},validate:function(b,c,d){console.log(b);if(d.lastValue==c&&d.lastFinished==true){return d.lastValid==false}if(d.lastFinished==true){d.lastValue=c;d.lastValid=true;d.lastFinished=false;a.ajax({url:d.url,data:"value="+c+"&field="+b.attr("name"),dataType:"json",success:function(a){if(d.lastValue==a.value){d.lastValid=a.valid;if(a.message){d.message=a.message}d.lastFinished=true;b.data("validation"+d.validatorName+"Message",d.message);setTimeout(function(){b.trigger("change.validation")},1)}},failure:function(){d.lastValid=true;d.message="ajax call failed";d.lastFinished=true;b.data("validation"+d.validatorName+"Message",d.message);setTimeout(function(){b.trigger("change.validation")},1)}})}return false}},regex:{name:"regex",init:function(a,b){return{regex:g(a.data("validation"+b+"Regex"))}},validate:function(a,b,c){return!c.regex.test(b)&&!c.negative||c.regex.test(b)&&c.negative}},required:{name:"required",init:function(a,b){return{}},validate:function(a,b,c){return!!(b.length==0&&!c.negative)||!!(b.length>0&&c.negative)},blockSubmit:true},match:{name:"match",init:function(a,b){var c=a.parents("form").first().find('[name="'+a.data("validation"+b+"Match")+'"]').first();c.bind("validation.validation",function(){a.trigger("change.validation",{submitting:true})});return{element:c}},validate:function(a,b,c){return b!=c.element.val()&&!c.negative||b==c.element.val()&&c.negative},blockSubmit:true},max:{name:"max",init:function(a,b){return{max:a.data("validation"+b+"Max")}},validate:function(a,b,c){return parseFloat(b,10)>parseFloat(c.max,10)&&!c.negative||parseFloat(b,10)<=parseFloat(c.max,10)&&c.negative}},min:{name:"min",init:function(a,b){return{min:a.data("validation"+b+"Min")}},validate:function(a,b,c){return parseFloat(b)<parseFloat(c.min)&&!c.negative||parseFloat(b)>=parseFloat(c.min)&&c.negative}},maxlength:{name:"maxlength",init:function(a,b){return{maxlength:a.data("validation"+b+"Maxlength")}},validate:function(a,b,c){return b.length>c.maxlength&&!c.negative||b.length<=c.maxlength&&c.negative}},minlength:{name:"minlength",init:function(a,b){return{minlength:a.data("validation"+b+"Minlength")}},validate:function(a,b,c){return b.length<c.minlength&&!c.negative||b.length>=c.minlength&&c.negative}},maxchecked:{name:"maxchecked",init:function(a,b){var c=a.parents("form").first().find('[name="'+a.attr("name")+'"]');c.bind("click.validation",function(){a.trigger("change.validation",{includeEmpty:true})});return{maxchecked:a.data("validation"+b+"Maxchecked"),elements:c}},validate:function(a,b,c){return c.elements.filter(":checked").length>c.maxchecked&&!c.negative||c.elements.filter(":checked").length<=c.maxchecked&&c.negative},blockSubmit:true},minchecked:{name:"minchecked",init:function(a,b){var c=a.parents("form").first().find('[name="'+a.attr("name")+'"]');c.bind("click.validation",function(){a.trigger("change.validation",{includeEmpty:true})});return{minchecked:a.data("validation"+b+"Minchecked"),elements:c}},validate:function(a,b,c){return c.elements.filter(":checked").length<c.minchecked&&!c.negative||c.elements.filter(":checked").length>=c.minchecked&&c.negative},blockSubmit:true}},builtInValidators:{email:{name:"Email",type:"shortcut",shortcut:"validemail"},validemail:{name:"Validemail",type:"regex",regex:"[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,4}",message:"Not a valid email address"},passwordagain:{name:"Passwordagain",type:"match",match:"password",message:"Does not match the given password"},positive:{name:"Positive",type:"shortcut",shortcut:"number,positivenumber"},negative:{name:"Negative",type:"shortcut",shortcut:"number,negativenumber"},number:{name:"Number",type:"regex",regex:"([+-]?\\d+(\\.\\d*)?([eE][+-]?[0-9]+)?)?",message:"Must be a number"},integer:{name:"Integer",type:"regex",regex:"[+-]?\\d+",message:"No decimal places allowed"},positivenumber:{name:"Positivenumber",type:"min",min:0,message:"Must be a positive number"},negativenumber:{name:"Negativenumber",type:"max",max:0,message:"Must be a negative number"},required:{name:"Required",type:"required",message:"This is required"},checkone:{name:"Checkone",type:"minchecked",minchecked:1,message:"Check at least one option"}}};var d=function(a){return a.toLowerCase().replace(/(^|\s)([a-z])/g,function(a,b,c){return b+c.toUpperCase()})};var f=function(b){var c=b.val();var d=b.attr("type");if(d=="checkbox"){c=b.is(":checked")?c:""}if(d=="radio"){c=a('input[name="'+b.attr("name")+'"]:checked').length>0?c:""}return c};a.fn.jqBootstrapValidation=function(b){if(c.methods[b]){return c.methods[b].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof b==="object"||!b){return c.methods.init.apply(this,arguments)}else{a.error("Method "+b+" does not exist on jQuery.jqBootstrapValidation");return null}};a.jqBootstrapValidation=function(b){a(":input").not("[type=image],[type=submit]").jqBootstrapValidation(b)}})(jQuery)